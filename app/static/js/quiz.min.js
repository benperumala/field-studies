function getRandomIntInclusive(a,b){return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a+1))+a}function quizOptions(a,b){choices=genQuizOptions(a,b),displayQuizOptions(choices)}function orgGetRandom(a){return orgRandom=a[Math.floor(Math.random()*a.length)],orgRandom}function orgsWithSound(a){return sounds=a.filter(function(a){return 1==a.sound}),sounds}function orgsImportant(a){return important=a.filter(function(a){return 1==a.important}),important}function genQuizOptions(a,b){for(options=[],tries=0;options.length<4&&tries<25;)tries+=1,orgRand=orgGetRandom(a),$.inArray(orgRand.id,b)==-1&&$.inArray(orgRand,options)==-1?options.push(orgRand):console.debug(orgRand.id+" rejected");return options}function quizOptionsNew(){$("#onlySounds").is(":checked")?quizOptions(orgsWithSound(orgs),orgsCorrect):quizOptions(orgs,orgsCorrect)}function spellingShow(){$("#spelling-button").show()}function spellingHide(){$("#spelling-button").hide(),$("#spelling-debug").hide()}function displayQuizOptions(a){prevOrgCorrect=orgCorrect;do correct=getRandomIntInclusive(0,3),orgCorrect=a[correct],Math.seedrandom(orgCorrect.scientific_name+Math.random().toString(),{entropy:!0});while(orgCorrect.id==prevOrgCorrect.id);for($(".quiz-option").attr("data-id",""),id=0;id<4;id++)cOrg=a[id],id==correct&&$("."+id).attr("data-id",cOrg.id),$("."+id).text(cOrg.name);"birds"==DB_NAME&&74==orgCorrect.id?$("#picture").attr("src",PATH_IMAGES+orgCorrect.id+".winter.jpg"):$("#picture").attr("src",PATH_IMAGES+orgCorrect.id+".jpg"),orgCorrect.sound?(audio=$("#audio audio"),$("source.mp3").attr("src",PATH_AUDIO+orgCorrect.id+".mp3"),$("source.ogg").attr("src",PATH_AUDIO+orgCorrect.id+".ogg"),audio[0].load(),$("#audio").show()):$("#audio").hide(),orgCorrect.description?$(".description").html(orgCorrect.description.split("\\n").join("<br />")):$(".description").text("No available description. Sorry!")}function resetOptions(){window.firstTry=!0,$(".input-group-btn button").removeClass("btn-danger btn-success").addClass("btn-primary"),$(".input-group").removeClass("has-error has-success"),$("#spelling").val(""),$(".quiz-option").removeClass("btn-danger btn-success").addClass("btn-primary")}var orgCorrect={id:-1},prevOrgCorrect={id:-1},mainOrgArray,orgsCorrect=[];$("#onlySounds").click(function(){if(orgsCorrect=[],$(this).is(":checked"))var a=orgsWithSound(orgs);else var a=orgs;quizOptions(a,orgsCorrect)}),$("#onlyImportant").click(function(){if(orgsCorrect=[],$(this).is(":checked"))var a=orgsImportant(orgs);else var a=orgs;quizOptions(a,orgsCorrect)}),$("#noThumbnail").click(function(){$(this).is(":checked")?$("#picture").hide():$("#picture").show()}),$("#showDescription").click(function(){$(this).is(":checked")?$(".description").hide():$(".description").show()}),$("#onlySpelling").click(function(){$(this).is(":checked")?($(".multiple-choice").hide(),$(".single-choice").show(),$("#spelling").focus()):($(".multiple-choice").show(),$(".single-choice").hide())});var firstTry=!0,allowQuiz=1,correctAnswer=0;$("form").submit(function(a){if(a.preventDefault(),allowQuiz){for(spelling_quiz=cleanText($("#spelling").val()),orgCorrect.name.indexOf("(")>-1?(arr_corr=orgCorrect.name.toLowerCase().split("("),arr_corr[1]=arr_corr[1].match(/(.*).$/)[1],$.map(arr_corr,$.trim)):arr_corr=[orgCorrect.name.toLowerCase()],console.debug("--------------------------------------"),window.correctAnswer=0,x=0;x<arr_corr.length;x++)spelling_correct=cleanText(arr_corr[x]),condition=spelling_quiz==spelling_correct,console.debug('"'+spelling_quiz+'" == "'+spelling_correct+'" ('+condition+")"),spelling_quiz==spelling_correct&&(window.correctAnswer=1);if(window.correctAnswer)$(".input-group-btn button").removeClass("btn-primary btn-danger").addClass("btn-success"),$(".input-group").removeClass("has-error").addClass("has-success"),window.allowQuiz=0,window.setTimeout(function(){spellingHide(),resetOptions(),quizOptionsNew(),window.allowQuiz=1},1e3);else{if($(".input-group-btn button").removeClass("btn-primary").addClass("btn-danger"),$(".input-group").addClass("has-error"),diffDebug="",arr_corr.length>1)for(x=0;x<arr_corr.length;x++)spelling_correct=cleanText(arr_corr[x]),diffDebug+=diffString(spelling_quiz,spelling_correct),diffDebug+=" OR ";else diffDebug=diffString(spelling_quiz,arr_corr[0]);window.diffDebug=diffDebug,diffDebug.endsWith("OR ")&&(diffDebug=diffDebug.slice(0,-1).replace(/\w+[.!?]?$/,"")),$("#spelling-debug").html(diffDebug),spellingShow()}}}),$(".quiz-option").click(function(){dataID=$(this).attr("data-id"),dataID?(window.firstTry&&window.orgsCorrect.push(parseInt(dataID)),$("audio").trigger("pause"),$("audio").prop("currentTime",0),$(this).removeClass("btn-primary").addClass("btn-success"),window.setTimeout(function(){resetOptions(),quizOptionsNew()},1e3)):(window.firstTry=!1,$(this).removeClass("btn-primary").addClass("btn-danger"))});
